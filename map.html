<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bangalore College Map</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- Marker Cluster -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

<!-- Search -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-search/dist/leaflet-search.src.css" />

<style>
body { margin: 0; font-family: Arial, sans-serif; }
#map { height: 100vh; width: 100%; }

.loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 15px;
  border-radius: 6px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  z-index: 999;
}

.popup h3 {
  margin: 0 0 5px;
  font-size: 16px;
  color: #2c3e50;
}

.popup p {
  margin: 4px 0;
  font-size: 13px;
}

.popup a {
  display: inline-block;
  margin-top: 8px;
  padding: 6px 10px;
  background: #007bff;
  color: #fff;
  text-decoration: none;
  border-radius: 4px;
  font-size: 13px;
}
.popup a:hover { background: #0056b3; }
</style>
</head>

<body>

<div id="map"></div>
<div id="loading" class="loading">Loading colleges...</div>

<!-- JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/leaflet-search/dist/leaflet-search.src.js"></script>

<script>
const map = L.map('map').setView([12.9716, 77.5946], 11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '¬© OpenStreetMap'
}).addTo(map);

const cluster = L.markerClusterGroup();
map.addLayer(cluster);

const collegeIcon = L.icon({
  iconUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon.png',
  shadowUrl: 'https://unpkg.com/leaflet/dist/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41]
});

const jsonUrl = "https://raw.githubusercontent.com/taruncodeplace6666/data/main/colleges.json";

fetch(jsonUrl)
  .then(res => {
    if (!res.ok) throw new Error("Failed to load JSON");
    return res.json();
  })
  .then(data => {
    document.getElementById("loading").style.display = "none";

    data.forEach(college => {
      const lat = parseFloat(college.Latitude);
      const lng = parseFloat(college.Longitude);

      if (isNaN(lat) || isNaN(lng)) return;

      const popup = `
        <div class="popup">
          <h3>${college.Name || "Unknown College"}</h3>
          <p><b>üìç</b> ${college.Location || "N/A"}</p>
          <p><b>üìå</b> ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>
          <a href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}" target="_blank">
            üöó Get Directions
          </a>
        </div>
      `;

      const marker = L.marker([lat, lng], {
        icon: collegeIcon,
        title: college.Name
      }).bindPopup(popup);

      marker.collegeName = college.Name;
      cluster.addLayer(marker);
    });

    map.fitBounds(cluster.getBounds(), { padding: [40, 40] });

    const search = new L.Control.Search({
      layer: cluster,
      propertyName: 'collegeName',
      zoom: 15,
      marker: false,
      textPlaceholder: "Search college..."
    });

    search.on("search:locationfound", e => e.layer.openPopup());
    map.addControl(search);
  })
  .catch(err => {
    document.getElementById("loading").innerHTML =
      `<b style="color:red">Error loading data</b><br>${err.message}`;
  });

L.control.scale().addTo(map);
</script>

</body>
</html>
